<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="ForeverCoder&#39;s Blog">
<meta property="og:url" content="http://forevercoder.com/index.html">
<meta property="og:site_name" content="ForeverCoder&#39;s Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ForeverCoder&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://forevercoder.com/"/>





  <title>ForeverCoder's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?266ec7caa9a4380a1168e6984e3d97a8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ForeverCoder's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/11/Linux基本命令-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Linux基本命令-1/" itemprop="url">Linux基本命令_1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T16:05:45+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux基础/" itemprop="url" rel="index">
                    <span itemprop="name">Linux基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/11/Linux基本命令-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/11/Linux基本命令-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/11/Linux基本命令-1/" class="leancloud_visitors" data-flag-title="Linux基本命令_1">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="切换终端"><a href="#切换终端" class="headerlink" title="切换终端"></a>切换终端</h3><pre><code>control + alt + F1/F2/F3...
</code></pre><ul>
<li>查看当前终端设备 : tty</li>
<li>查看当前终端登录的用户:whoami/who am i</li>
<li>查看所有登录的用户    :who</li>
<li>查看运行模式:runlevel</li>
<li>切换图像/终端: init 3/5 <pre><code>//3:终端，5：图像界面
</code></pre></li>
</ul>
<h3 id="命令提示符"><a href="#命令提示符" class="headerlink" title="命令提示符"></a>命令提示符</h3><ul>
<li><p>命令提示符：prompt</p>
<pre><code>[root@localhost ~]#
#:管理员  $ 普通用户
</code></pre></li>
<li>显示提示符格式：#echo $PS1</li>
<li><p>修改提示符格式</p>
<pre><code>PS1 = &quot;\[\e[1;5;41;33m\][\u@\h \w]\\$\[\e[0m\]&quot;
</code></pre></li>
</ul>
<pre><code>\e : \033           \u 当前用户
\h 主机名简称       \H 主机名
\w 当前工作目录     \W 当前工作目录基名
\t 24小时时间格式   \T 12小时时间格式
\! 命令历史数       \# 开机后命令历史数
</code></pre><ul>
<li>登录提示文件：/etc/motd</li>
</ul>
<h3 id="使用shell-linux命令解释器"><a href="#使用shell-linux命令解释器" class="headerlink" title="使用shell (linux命令解释器)"></a>使用shell (linux命令解释器)</h3><ul>
<li><p>查看正在使用的shell  </p>
<p>  echo $SHELL </p>
</li>
<li><p>查看系统支持的shell类型</p>
<p>  cat /etc/shells </p>
</li>
<li><p>切换shell</p>
<p> /bin/bash   </p>
</li>
<li><p>iterm2 切换shell</p>
<p>  chsh -s /bin/zsh</p>
</li>
</ul>
<p>&lt;–more–&gt;</p>
<h3 id="硬件信息"><a href="#硬件信息" class="headerlink" title="硬件信息"></a>硬件信息</h3><ul>
<li>内核版本: uname -r</li>
<li>磁盘容量信息:lsblk</li>
<li>内存使用信息: free -m/g</li>
<li>cpu使用率:top</li>
</ul>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p>在shell中可执行的命令有两类</p>
<ul>
<li><p>内部命令：shell自带的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">help  内部命令列表</div><div class="line">enable [cmd] 启动内部命令</div><div class="line">enable -n [cmd] 禁止内部命令</div><div class="line">enable -n 查看所有禁止的内部命令</div></pre></td></tr></table></figure>
</li>
<li><p>外部命令: 系统路径$PATH下对应的可执行文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">查看路径: which -a |--ship-alias; whereis</div></pre></td></tr></table></figure>
</li>
<li><p>使用type 区分内外部命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# type pwd</div><div class="line">pwd is a shell builtin</div><div class="line">[root@localhost ~]# type free</div><div class="line">free is /usr/bin/free</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Hash缓存表"><a href="#Hash缓存表" class="headerlink" title="Hash缓存表"></a>Hash缓存表</h3><blockquote>
<p>系统初始hash表为空，执行外部命令时，先从PATH路径<br>寻找，然后将该条命令的路径加到hash表中，下次执行时直接从hash表中查找。</p>
</blockquote>
<p>hash常见用法</p>
<ul>
<li><p>hash 显示hash缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# hash</div><div class="line">hits    command</div><div class="line">   1    /usr/bin/whereis</div><div class="line">   4    /usr/bin/ls</div></pre></td></tr></table></figure>
</li>
<li><p>hash -l 显示hash缓存，可作为输入使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# hash -l</div><div class="line">builtin hash -p /usr/bin/whereis whereis</div><div class="line">builtin hash -p /usr/bin/ls ls</div><div class="line">builtin hash -p /usr/bin/free free</div></pre></td></tr></table></figure>
</li>
<li><p>hash -p path name 将命令全路径path起别名为name</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# hash -p /usr/bin/free f</div><div class="line">[root@localhost ~]# f</div><div class="line">              total        used        free      shared  buff/cache   available</div><div class="line">Mem:         995896      144196      681788        7824      169912      671712</div><div class="line">Swap:       2097148           0     2097148</div></pre></td></tr></table></figure>
</li>
<li><p>hash -t name 打印缓存中name的路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# hash -t f</div><div class="line">/usr/bin/free</div></pre></td></tr></table></figure>
</li>
<li><p>hash -d name 清除name缓存</p>
</li>
<li>hash -r  清除缓存</li>
</ul>
<h3 id="命令别名"><a href="#命令别名" class="headerlink" title="命令别名"></a>命令别名</h3><ul>
<li><p>alias 显示当前shell进程所有可用的命令别名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@localhost network-scripts]# alias</div><div class="line">alias cdnet=&apos;cd /etc/sysconfig/network-scripts/&apos;</div><div class="line">alias cp=&apos;cp -i&apos;</div><div class="line">alias egrep=&apos;egrep --color=auto&apos;</div><div class="line">alias fgrep=&apos;fgrep --color=auto&apos;</div><div class="line">alias grep=&apos;grep --color=auto&apos;</div><div class="line">alias l.=&apos;ls -d .* --color=auto&apos;</div><div class="line">alias ll=&apos;ls -l --color=auto&apos;</div><div class="line">alias ls=&apos;ls --color=auto&apos;</div><div class="line">alias mv=&apos;mv -i&apos;</div><div class="line">alias rm=&apos;rm -i&apos;</div><div class="line">alias which=&apos;alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>alias cdnet=’cd /etc/sysconfig/network-scripts/‘ 起别名</p>
</li>
<li><p>要想永久有效，要定义在配置文件中</p>
<ul>
<li>仅对当前用户: ~/.bashrc</li>
<li>对所有用户有效:/etc/bashrc</li>
</ul>
</li>
<li>bash进程重新读取配置文件：<br>source .bashrc 或者 . .bashrc</li>
<li>撤销别名 unalias ,-a 取消所有别名<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost /]# unalias cdnet</div><div class="line">[root@localhost /]# cdnet</div><div class="line">-bash: cdnet: command not found</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h3><ul>
<li>硬件时钟：clock</li>
<li>系统时间：date</li>
<li>设置系统时间：date 011517032019.00</li>
<li>同步系统时间到硬件时间：clock -w</li>
<li>从服务器同步：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ntpdate 172.16.0.1 //server</div><div class="line">vi /etc/ntp.conf</div><div class="line">server 172.16.0.1 iburst</div><div class="line">service ntpd start</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="简单命令"><a href="#简单命令" class="headerlink" title="简单命令"></a>简单命令</h3><ul>
<li>关机: halt,poweroff</li>
<li>重启: reboot</li>
<li>关机或重启:shutdown<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-r:reboot</div><div class="line">-h:halt</div><div class="line">-c:cancel</div><div class="line">TIME:无指定，默认相当于+1</div><div class="line">     now</div><div class="line">     +m:几分钟后</div><div class="line">     hh:mm ；精确到具体时间</div><div class="line"></div><div class="line">* 显示字符: echo</div></pre></td></tr></table></figure>
</li>
</ul>
<p>显示变量:echo $VAR_NAMR<br>原样输出:echo ‘name’ //单引号<br>```</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/10/Dagger2（五）Android中的扩展使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Dagger2（五）Android中的扩展使用/" itemprop="url">Dagger2（五）Android中的扩展使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:45:03+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dagger2/" itemprop="url" rel="index">
                    <span itemprop="name">Dagger2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/10/Dagger2（五）Android中的扩展使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/10/Dagger2（五）Android中的扩展使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/10/Dagger2（五）Android中的扩展使用/" class="leancloud_visitors" data-flag-title="Dagger2（五）Android中的扩展使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在Android平台上使用Dagger的一个主要的不同是，很多类的实例化依赖于操作系统本身，像是Activity和Fragment，但是Dagger最理想的工作方式是它能够构造所有需要注入的类的实例。所以，你必须在它们（Activity、Fragment等）的生命周期中进行成员的注入。很多类看上去跟下面类似：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FrombulationActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">  <span class="meta">@Inject</span> Frombulator frombulator;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    <span class="comment">//先写如下代码， 否则frombulator可能为null!</span></div><div class="line">    ((SomeApplicationBaseType) getContext().getApplicationContext())</div><div class="line">        .getApplicationComponent()</div><div class="line">        .newActivityComponentBuilder()</div><div class="line">        .activity(<span class="keyword">this</span>)</div><div class="line">        .build()</div><div class="line">        .inject(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">// ...其它代码</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这么做有以下问题：</p>
<ol>
<li>复制粘贴同样的代码使得以后想要重构变得困难。越来越多的这样复制粘贴的代码，开发者反而对这段代码的作用了解的更少。</li>
<li>更加重要的是，它需要被注入类（FrombulationActivity）知道它的注入类。即使这是通过接口实现的，而不是具体的类。但是，这仍然破坏了依赖注入的的核心原则：一个类不应该对它是如何被注入的有任何的了解.<br>(a class shouldn’t know anything about how it is injected.)</li>
</ol>
<p>dagger.android 可以用来简化以上步骤。</p>
<h4 id="build-gradle添加依赖"><a href="#build-gradle添加依赖" class="headerlink" title="build.gradle添加依赖:"></a>build.gradle添加依赖:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">implementation &apos;com.google.dagger:dagger-android:2.20&apos;</div><div class="line">implementation &apos;com.google.dagger:dagger-android-support:2.20&apos;</div></pre></td></tr></table></figure>
<h4 id="Activity的注入"><a href="#Activity的注入" class="headerlink" title="Activity的注入"></a>Activity的注入</h4><ol>
<li>在你的Application Component中加入AndroidInjectionModule模块，以提供所有基本类型的绑定。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Component(modules = &#123;AndroidInjectionModule.class,</div><div class="line">        ...&#125;)</div><div class="line">public interface ApplicationComponent &#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AndroidInjectionModule是一个普通的Module,其中声明了两种Multibinds<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Beta</span></div><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AndroidInjectionModule</span> </span>&#123;</div><div class="line">  <span class="meta">@Multibinds</span></div><div class="line">  <span class="keyword">abstract</span> Map&lt;Class&lt;?&gt;, AndroidInjector.Factory&lt;?&gt;&gt; classKeyedInjectorFactories();</div><div class="line"></div><div class="line">  <span class="meta">@Multibinds</span></div><div class="line">  <span class="keyword">abstract</span> Map&lt;String, AndroidInjector.Factory&lt;?&gt;&gt; stringKeyedInjectorFactories();</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">AndroidInjectionModule</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>声明subcomponent并且实现接口AndroidInjector<youractivity>，该subcomponent需要有一个被@Subcomponent.Builder注解的并扩展自AndroidInjector.Builder<youractivity>的构造器：</youractivity></youractivity></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Subcomponent</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainActivitySubComponent</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Subcomponent</span>.Builder</div><div class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>.<span class="title">Builder</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>声明过subcomponent之后，把它通过如下方式加入到主component体系中：定义一个提供该subcomponent builder的module，并且把该module加入到你的AppComponent中。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span>(subcomponents = MainActivitySubComponent.class)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MainModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Binds</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@ClassKey</span>(MainActivity.class)</div><div class="line">    <span class="keyword">abstract</span> AndroidInjector.Factory&lt;?&gt;</div><div class="line">    bindYourMainActivityInjectorFactory(MainActivitySubComponent.Builder builder);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>注意：如果你的subcomponent和它的builder除了第2步中提及的方法或者超类没有其它的内容，你可以用 @ContributesAndroidInjector生成2、3步中的一切。现在不需要步骤2和3，你只需声明一个abstract module，返回你所需的activity（用 @ContributesAndroidInjector注解），可以声明subcomponent需要的其它的module。如果这个subcomponent需要scope注解，也可以声明：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityBuildersModule</span> </span>&#123;</div><div class="line">    <span class="meta">@ActivityScope</span></div><div class="line">    <span class="meta">@ContributesAndroidInjector</span>(modules = &#123;<span class="comment">/*subcomponent需要的module*/</span>&#125;)</div><div class="line">    <span class="function"><span class="keyword">abstract</span> MainActivity <span class="title">contributeMainActivity</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Component</span>(modules = &#123;AndroidInjectionModule.class,</div><div class="line">        ActivityBuildersModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ContributesAndroidInjector注解会生成如下代码，和我们手写的是一样的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span>(</div><div class="line">  subcomponents = ActivityBulidersModule_ContributeMainActivity.MainActivitySubcomponent.class</div><div class="line">)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityBulidersModule_ContributeMainActivity</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">ActivityBulidersModule_ContributeMainActivity</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">  <span class="meta">@Binds</span></div><div class="line">  <span class="meta">@IntoMap</span></div><div class="line">  <span class="meta">@ClassKey</span>(MainActivity.class)</div><div class="line">  <span class="keyword">abstract</span> AndroidInjector.Factory&lt;?&gt; bindAndroidInjectorFactory(</div><div class="line">      MainActivitySubcomponent.Builder builder);</div><div class="line"></div><div class="line">  <span class="meta">@Subcomponent</span></div><div class="line">  <span class="meta">@ActivityScope</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainActivitySubcomponent</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Subcomponent</span>.Builder</div><div class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>.<span class="title">Builder</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;&#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>让你的Application实现HasActivityInjector并且@Inject DispatchingAndroidInjector<activity>而后从方法activityInjector()（接口HasActivityInjector中的方法）返回：</activity></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">HasActivityInjector</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    DispatchingAndroidInjector&lt;Activity&gt; dispatchingActivityInjector;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> AndroidInjector&lt;Activity&gt; <span class="title">activityInjector</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> dispatchingActivityInjector;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>最后，在 Activity.onCreate() 方法中在super.onCreate()之前调用AndroidInjection.inject(this)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MainActivity.class.getSimpleName();</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    UserService userService;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        AndroidInjection.inject(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        Log.d(TAG, userService.getUserName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="How-did-that-work-如何工作？"><a href="#How-did-that-work-如何工作？" class="headerlink" title="How did that work? 如何工作？"></a>How did that work? 如何工作？</h4><blockquote>
<p>AndroidInjection.inject() 从Application中获取了一个 DispatchingAndroidInjector<activity>，并把activity实例传入方法 inject(Activity)中。 DispatchingAndroidInjector 根据activity的class来查找 AndroidInjector.Factory（即 YourActivitySubcomponent.Builder），创建 AndroidInjector (即YourActivitySubcomponent)， 然后把你的activity实例传入方法 inject(YourActivity)中。</activity></p>
</blockquote>
<p>AndroidInjection.inject(),获取App对象的dispatchingActivityInjector，调用inject(MainAcitivty)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public static void inject(Activity activity) &#123;</div><div class="line">    checkNotNull(activity, &quot;activity&quot;);</div><div class="line">    Application application = activity.getApplication();</div><div class="line">    if (!(application instanceof HasActivityInjector)) &#123;</div><div class="line">      throw new RuntimeException(</div><div class="line">          String.format(</div><div class="line">              &quot;%s does not implement %s&quot;,</div><div class="line">              application.getClass().getCanonicalName(),</div><div class="line">              HasActivityInjector.class.getCanonicalName()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    AndroidInjector&lt;Activity&gt; activityInjector =</div><div class="line">        ((HasActivityInjector) application).activityInjector();</div><div class="line">    checkNotNull(activityInjector, &quot;%s.activityInjector() returned null&quot;, application.getClass());</div><div class="line"></div><div class="line">    activityInjector.inject(activity);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>再看看DispatchingAndroidInjector的inject()方法，调用的是maybeInject()方法,<br>让后根据activity的class来查找 AndroidInjector.Factory（即 YourActivitySubcomponent.Builder），创建 AndroidInjector (即YourActivitySubcomponent)， 然后把你的activity实例传入方法 inject(YourActivity)中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void inject(T instance) &#123;</div><div class="line">    boolean wasInjected = maybeInject(instance);</div><div class="line">    if (!wasInjected) &#123;</div><div class="line">      throw new IllegalArgumentException(errorMessageSuggestions(instance));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public boolean maybeInject(T instance) &#123;</div><div class="line">    </div><div class="line">    //获取MainActivitySubcomponentImpl</div><div class="line">    Provider&lt;AndroidInjector.Factory&lt;?&gt;&gt; factoryProvider =</div><div class="line">        injectorFactories.get(instance.getClass().getName());</div><div class="line">    if (factoryProvider == null) &#123;</div><div class="line">      return false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @SuppressWarnings(&quot;unchecked&quot;)</div><div class="line">    AndroidInjector.Factory&lt;T&gt; factory = (AndroidInjector.Factory&lt;T&gt;) factoryProvider.get();</div><div class="line">    try &#123;</div><div class="line">      AndroidInjector&lt;T&gt; injector =</div><div class="line">          checkNotNull(</div><div class="line">              factory.create(instance), &quot;%s.create(I) should not return null.&quot;, factory.getClass());</div><div class="line"></div><div class="line">      //调用MainActivitySubcomponentImpl的inject(MainActivity)</div><div class="line">      injector.inject(instance);</div><div class="line">      return true;</div><div class="line">    &#125; catch (ClassCastException e) &#123;</div><div class="line">      throw new InvalidInjectorBindingException(</div><div class="line">          String.format(</div><div class="line">              &quot;%s does not implement AndroidInjector.Factory&lt;%s&gt;&quot;,</div><div class="line">              factory.getClass().getCanonicalName(), instance.getClass().getCanonicalName()),</div><div class="line">          e);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  //MainActivitySubcomponentImpl</div><div class="line">  private final class MainActivitySubcomponentImpl</div><div class="line">      implements ActivityBulidersModule_ContributeMainActivity.MainActivitySubcomponent &#123;</div><div class="line">    private MainActivitySubcomponentImpl(MainActivitySubcomponentBuilder builder) &#123;&#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void inject(MainActivity arg0) &#123;</div><div class="line">      injectMainActivity(arg0);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private MainActivity injectMainActivity(MainActivity instance) &#123;</div><div class="line">      MainActivity_MembersInjector.injectUserService(instance, new UserService());</div><div class="line">      return instance;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="dagger-android-support-进一步简化"><a href="#dagger-android-support-进一步简化" class="headerlink" title="dagger.android.support 进一步简化"></a>dagger.android.support 进一步简化</h4><ol>
<li><p>ApplicationComponent继承AndroidInjector<app>，并且添加Component.Builder,Builder类继承AndroidInjector.Builder<app></app></app></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(modules = &#123;AndroidInjectionModule.class,</div><div class="line">        ActivityBuildersModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>&lt;<span class="title">App</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Component</span>.Builder</div><div class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">extends</span> <span class="title">AndroidInjector</span>.<span class="title">Builder</span>&lt;<span class="title">App</span>&gt; </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>我们的Application继承dagger.android.support.DaggerApplication，重写applicationInjector方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">DaggerApplication</span> </span>&#123;</div><div class="line">  </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> AndroidInjector&lt;App&gt; <span class="title">applicationInjector</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> DaggerApplicationComponent.builder().create(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Activity继承DaggerAppCompatActivity,无需调用AndroidInjection.inject()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">DaggerAppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MainActivity.class.getSimpleName();</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    UserService userService;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        </div><div class="line">        Log.d(TAG, userService.getUserName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><a href="https://github.com/zhy060307/dagger2" target="_blank" rel="external">Demo Github地址</a></p>
<p>参考：<br><a href="https://www.jianshu.com/p/ad777c73b528" target="_blank" rel="external">https://www.jianshu.com/p/ad777c73b528</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/10/Dagger2（四）Multibindings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Dagger2（四）Multibindings/" itemprop="url">Dagger2（四）Multibindings</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:43:05+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dagger2/" itemprop="url" rel="index">
                    <span itemprop="name">Dagger2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/10/Dagger2（四）Multibindings/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/10/Dagger2（四）Multibindings/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/10/Dagger2（四）Multibindings/" class="leancloud_visitors" data-flag-title="Dagger2（四）Multibindings">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Multibindings"><a href="#Multibindings" class="headerlink" title="Multibindings"></a>Multibindings</h3><blockquote>
<p>Dagger allows you to bind several objects into a collection even when the objects are bound in different modules using multibindings.</p>
</blockquote>
<p>Dagger的Multibindings功能可以生成集合，无需直接依赖其他单独的绑定。  </p>
<h4 id="Set-multibindings"><a href="#Set-multibindings" class="headerlink" title="Set multibindings"></a>Set multibindings</h4><p>可以将一个或多个值绑定到一个Set中。</p>
<ul>
<li>IntoSet,提供单一的值。</li>
<li>ElementsIntoSet，提供subset。<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetModuleA</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoSet</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">provideOneString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"ABC"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@ElementsIntoSet</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">provideSomeStrings</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="string">"DEF"</span>, <span class="string">"GHI"</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>然后注入Set<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FourthActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    Set&lt;String&gt; mySet;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_third);</div><div class="line">        DaggerMultiBindingsComponent</div><div class="line">                .create().inject(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBindings</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Log.d(<span class="string">"Inject mySet value is"</span>, mySet.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">Logcat:com.zhy.dagger2 D/Inject mySet value is: [ABC, DEF, GHI]</div></pre></td></tr></table></figure></p>
<p>Daager生成的代码：</p>
<p>DaggerMultiBindingsComponent的关键代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerMultiBindingsComponent</span> <span class="keyword">implements</span> <span class="title">MultiBindingsComponent</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> SetModuleA setModuleA;</div><div class="line">  <span class="comment">//....</span></div><div class="line">  <span class="function"><span class="keyword">private</span> Set&lt;String&gt; <span class="title">getSetOfString</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> SetBuilder.&lt;String&gt;newSetBuilder(<span class="number">2</span>)</div><div class="line">        .add(SetModuleA_ProvideOneStringFactory.proxyProvideOneString(setModuleA))</div><div class="line">        .addAll(SetModuleA_ProvideSomeStringsFactory.proxyProvideSomeStrings(setModuleA))</div><div class="line">        .build();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(FourthActivity fourthActivity)</span> </span>&#123;</div><div class="line">    injectFourthActivity(fourthActivity);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> FourthActivity <span class="title">injectFourthActivity</span><span class="params">(FourthActivity instance)</span> </span>&#123;</div><div class="line">    FourthActivity_MembersInjector.injectMySet(instance, getSetOfString());</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到getSetOfString()用来组装Set.</p>
<h5 id="Qualifier限定要注入的Set"><a href="#Qualifier限定要注入的Set" class="headerlink" title="Qualifier限定要注入的Set"></a>Qualifier限定要注入的Set</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetModuleB</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@ElementsIntoSet</span></div><div class="line">    <span class="meta">@MyQualifier</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">provideSpecialSomeStrings</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="string">"Hello"</span>, <span class="string">"Dagger2"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FourthActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = FourthActivity.class.getSimpleName();</div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    Set&lt;String&gt; mySet;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="meta">@MyQualifier</span></div><div class="line">    Lazy&lt;Set&lt;String&gt;&gt; myOnlySet;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_third);</div><div class="line">        DaggerMultiBindingsComponent</div><div class="line">                .create().inject(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBindings</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"Inject mySet value is"</span> + mySet.toString());</div><div class="line">        Log.d(TAG, <span class="string">"Inject myOnlySet value is"</span> + myOnlySet.get().toString());</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">Logcat:</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">06</span>:<span class="number">22.761</span> <span class="number">17005</span>-<span class="number">17005</span>/com.zhy.dagger2 D/FourthActivity: Inject mySet value is[ABC, DEF, GHI]</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">06</span>:<span class="number">22.761</span> <span class="number">17005</span>-<span class="number">17005</span>/com.zhy.dagger2 D/FourthActivity: Inject myOnlySet value is[Hello, Dagger2]</div></pre></td></tr></table></figure>
<ul>
<li>Lazy<set<string>&gt;不能写成 Set<lazy<string>&gt;</lazy<string></set<string></li>
</ul>
<h4 id="Map-multibindings"><a href="#Map-multibindings" class="headerlink" title="Map multibindings"></a>Map multibindings</h4><p>使用@IntoMap</p>
<h5 id="Simple-map-keys"><a href="#Simple-map-keys" class="headerlink" title="Simple map keys"></a>Simple map keys</h5><ul>
<li>String,Class&lt;?&gt;,boxed primitives 作为key。</li>
<li>枚举Enmu，更具体参数化类 作为key。<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapModuleA</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@StringKey</span>(<span class="string">"foo"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">provideStringKeyValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">100L</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@LongKey</span>(<span class="number">200</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">providePrimitivesKeyValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"value for LongKey"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@ClassKey</span>(MyClassKey.class)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">provideClassKeyValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"value for MyClassKey"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Component</span>(modules = &#123;SetModuleA.class,</div><div class="line">        SetModuleB.class,</div><div class="line">        MapModuleA.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultiBindingsComponent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(FourthActivity fourthActivity)</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Map&lt;String, Long&gt; <span class="title">longsByString</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Map&lt;Long, String&gt; <span class="title">stringsByLong</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    Map&lt;Class&lt;?&gt;, String&gt; stringsByClass();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//FourthActivity</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mapBindings</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        Log.d(TAG, <span class="string">"component.longsByString is"</span> + component.longsByString());</div><div class="line">        Log.d(TAG, <span class="string">"component.stringsByLong is"</span> + component.stringsByLong());</div><div class="line">        Log.d(TAG, <span class="string">"component.stringsByClass is"</span> + component.stringsByClass());</div><div class="line"></div><div class="line">    &#125;</div><div class="line">Logcat:</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">33</span>:<span class="number">47.832</span> <span class="number">17796</span>-<span class="number">17796</span>/com.zhy.dagger2 D/FourthActivity: component.longsByString is&#123;foo=<span class="number">100</span>&#125;</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">33</span>:<span class="number">47.833</span> <span class="number">17796</span>-<span class="number">17796</span>/com.zhy.dagger2 D/FourthActivity: component.stringsByLong is&#123;<span class="number">200</span>=value <span class="keyword">for</span> LongKey&#125;</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">33</span>:<span class="number">47.835</span> <span class="number">17796</span>-<span class="number">17796</span>/com.zhy.dagger2 D/FourthActivity: component.stringsByClass is&#123;<span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">zhy</span>.<span class="title">dagger2</span>.<span class="title">multibindings</span>.<span class="title">MyClassKey</span></span>=value <span class="keyword">for</span> MyClassKey&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>对于具有枚举键或更具体参数化类的映射，要自定义key，使用@MapKey注解标注。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Color &#123;</div><div class="line">    RED, GREEN, BLUE</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@MapKey</span></div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ColorKey &#123;</div><div class="line">    <span class="function">Color <span class="title">value</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@MapKey</span></div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyNumberClassKey &#123;</div><div class="line">    Class&lt;? extends Number&gt; value();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapModuleB</span> </span>&#123;</div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@ColorKey</span>(Color.BLUE)</div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">provideColorValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"value for BLUE"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@MyNumberClassKey</span>(BigDecimal.class)</div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">provideBigDecimalValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"value for BigDecimal"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Component</span>(modules = &#123;MapModuleB.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultiBindingsComponent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(FourthActivity fourthActivity)</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Map&lt;Color, String&gt; <span class="title">myEnumStringMap</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    Map&lt;Class&lt;? extends Number&gt;, String&gt; stringsByNumberClass();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//FourthActivity</span></div><div class="line">Log.d(TAG, <span class="string">"component.myEnumStringMap is"</span> + component.myEnumStringMap());</div><div class="line">Log.d(TAG, <span class="string">"component.stringsByNumberClass is"</span> + component.stringsByNumberClass());</div><div class="line"></div><div class="line">Logcat:</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">56</span>:<span class="number">39.563</span> <span class="number">18668</span>-<span class="number">18668</span>/com.zhy.dagger2 D/FourthActivity: component.myEnumStringMap is&#123;BLUE=value <span class="keyword">for</span> BLUE&#125;</div><div class="line"><span class="number">2019</span>-<span class="number">02</span>-<span class="number">10</span> <span class="number">07</span>:<span class="number">56</span>:<span class="number">39.563</span> <span class="number">18668</span>-<span class="number">18668</span>/com.zhy.dagger2 D/FourthActivity: component.stringsByNumberClass is&#123;<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">math</span>.<span class="title">BigDecimal</span></span>=value <span class="keyword">for</span> BigDecimal&#125;</div></pre></td></tr></table></figure>
<h5 id="Complex-map-keys"><a href="#Complex-map-keys" class="headerlink" title="Complex map keys"></a>Complex map keys</h5><p>Key可以是多种形式的组合，这个时候@MapKey(unwrapValue = false)，unwrapValue值要设为false。<br>实际开发用到很少。</p>
<h4 id="Declaring-multibindings"><a href="#Declaring-multibindings" class="headerlink" title="Declaring multibindings"></a>Declaring multibindings</h4><p>使用@Multibinds在抽象类的Module中声明。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MultibindsModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Multibinds</span></div><div class="line">    <span class="function"><span class="keyword">abstract</span> Set&lt;Foo&gt; <span class="title">aSet</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@Multibinds</span></div><div class="line">    <span class="meta">@MyQualifier</span></div><div class="line">    <span class="function"><span class="keyword">abstract</span> Set&lt;Foo&gt; <span class="title">aQualifiedSet</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@Multibinds</span></div><div class="line">    <span class="function"><span class="keyword">abstract</span> Map&lt;String, Foo&gt; <span class="title">aMap</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@Multibinds</span></div><div class="line">    <span class="meta">@MyQualifier</span></div><div class="line">    <span class="function"><span class="keyword">abstract</span> Map&lt;String, Foo&gt; <span class="title">aQualifiedMap</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">static</span> Object <span class="title">usesMultibindings</span><span class="params">(Set&lt;Foo&gt; set, @MyQualifier Map&lt;String, Foo&gt; map)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Inherited-subcomponent-multibindings"><a href="#Inherited-subcomponent-multibindings" class="headerlink" title="Inherited subcomponent multibindings"></a>Inherited subcomponent multibindings</h4><ul>
<li>ChildComponent包含ParentComponent中multibindings的set或map</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Subcomponent</span>(modules = ChildModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChildComponent</span> </span>&#123;</div><div class="line">    <span class="function">Set&lt;String&gt; <span class="title">strings</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Map&lt;String, String&gt; <span class="title">stringMap</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChildModule</span> </span>&#123;</div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoSet</span></div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">string3</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"child string 3"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoSet</span></div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">string4</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"child string 4"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@StringKey</span>(<span class="string">"c"</span>)</div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">stringC</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"child string C"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@StringKey</span>(<span class="string">"d"</span>)</div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">stringD</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"child string D"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@Component</span>(modules = ParentModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ParentComponent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function">Set&lt;String&gt; <span class="title">strings</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Map&lt;String, String&gt; <span class="title">stringMap</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function">ChildComponent <span class="title">childComponent</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentModule</span> </span>&#123;</div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoSet</span></div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">string1</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"parent string 1"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoSet</span></div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">string2</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"parent string 2"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@StringKey</span>(<span class="string">"a"</span>)</div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">stringA</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"parent string A"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="meta">@IntoMap</span></div><div class="line">    <span class="meta">@StringKey</span>(<span class="string">"b"</span>)</div><div class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">stringB</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"parent string B"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//FourthActivity</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subComponentsBindings</span><span class="params">(View view)</span> </span>&#123;</div><div class="line"></div><div class="line">    ParentComponent parentComponent = DaggerParentComponent.create();</div><div class="line">    ChildComponent childComponent = parentComponent.childComponent();</div><div class="line"></div><div class="line">    Log.d(TAG, <span class="string">" parentComponent.strings is"</span> + parentComponent.strings());</div><div class="line">    Log.d(TAG, <span class="string">" parentComponent.stringMap is"</span> + parentComponent.stringMap());</div><div class="line"></div><div class="line">    Log.d(TAG, <span class="string">" childComponent.strings is"</span> + childComponent.strings());</div><div class="line">    Log.d(TAG, <span class="string">" childComponent.stringMap is"</span> +childComponent.stringMap());</div><div class="line">&#125;</div><div class="line"></div><div class="line">Logcat:</div><div class="line">com.zhy.dagger2 D/FourthActivity:  parentComponent.strings is[parent string <span class="number">1</span>, parent string <span class="number">2</span>]</div><div class="line">com.zhy.dagger2 D/FourthActivity:  parentComponent.stringMap is&#123;a=parent string A, b=parent string B&#125;</div><div class="line">com.zhy.dagger2 D/FourthActivity:  childComponent.strings is[parent string <span class="number">1</span>, parent string <span class="number">2</span>, child string <span class="number">4</span>, child string <span class="number">3</span>]</div><div class="line">com.zhy.dagger2 D/FourthActivity:  childComponent.stringMap is&#123;a=parent string A, b=parent string B, c=child string C, d=child string D&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/zhy060307/dagger2" target="_blank" rel="external">Demo Github地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/10/Dagger2（三）Subcomponents/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Dagger2（三）Subcomponents/" itemprop="url">Dagger2（三）Subcomponents</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:41:32+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dagger2/" itemprop="url" rel="index">
                    <span itemprop="name">Dagger2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/10/Dagger2（三）Subcomponents/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/10/Dagger2（三）Subcomponents/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/10/Dagger2（三）Subcomponents/" class="leancloud_visitors" data-flag-title="Dagger2（三）Subcomponents">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Component之间除了dependencies依赖关系外，还可以有继承关系。</p>
<ul>
<li>依赖关系 <blockquote>
<p>一个 Component 依赖其他 Compoent 公开的依赖实例，用 Component 中的dependencies声明</p>
</blockquote>
</li>
<li>继承关系 <blockquote>
<p>一个 Component 继承（也可以叫扩展）某 Component 提供更多的依赖，SubComponent 就是继承关系的体现。</p>
</blockquote>
</li>
</ul>
<h4 id="依赖关系-dependencies"><a href="#依赖关系-dependencies" class="headerlink" title="依赖关系 dependencies"></a>依赖关系 dependencies</h4><p>MainComponent依赖AppComponent。</p>
<ul>
<li>MainComponent要使用AppComponent的PrintService，MainComponent必须显示提供方法将其暴露出来。</li>
<li>MainComponent和AppComponent的Scope不能相同，因为他们的生命周期不同。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Singleton</div><div class="line">@Component(modules = &#123;AppModule.class,</div><div class="line">        PrinterModule.class&#125;)</div><div class="line">public interface AppComponent &#123;</div><div class="line"></div><div class="line">    void inject(App app);</div><div class="line"></div><div class="line">    PrintService printService();</div><div class="line"></div><div class="line">&#125;</div><div class="line">//使用dependencies</div><div class="line">@ActivityScope</div><div class="line">@Component(dependencies = AppComponent.class)</div><div class="line">public interface MainComponent &#123;</div><div class="line">    void inject(MainActivity activity);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="继承关系-Subcomponents"><a href="#继承关系-Subcomponents" class="headerlink" title="继承关系 Subcomponents"></a>继承关系 Subcomponents</h4><h5 id="声明subcomponent"><a href="#声明subcomponent" class="headerlink" title="声明subcomponent"></a>声明subcomponent</h5><ul>
<li>和Component类似，必须是abstract class 或者interface.使用@Subcomponent标注。</li>
<li>Subcomponent和parent component的Scope不能相同，所有用自定义Scope @ActivityScope</li>
<li>SubComponent 必须显式地声明 Subcomponent.Builder，parent Component 需要用 Builder 来创建 SubComponent</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@ActivityScope</div><div class="line">@Subcomponent</div><div class="line">public interface SubMainComponent &#123;</div><div class="line"></div><div class="line">    @Subcomponent.Builder</div><div class="line">    interface Builder &#123;</div><div class="line"></div><div class="line">        SubMainComponent build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void inject(MainActivity mainActivity);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">@Singleton</div><div class="line">@Component(modules = &#123;AppModule.class, PrinterModule.class&#125;)</div><div class="line">public interface AppComponent &#123;</div><div class="line"></div><div class="line">    void inject(App app);// 继承关系中不用显式地提供暴露依赖实例的接口</div><div class="line"></div><div class="line">    SubMainComponent.Builder mainBuilder(); // 用来创建 Subcomponent</div><div class="line"></div><div class="line">    SubSecondComponent.Builder secondBuilder();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SubComponent 编译时不会生成 DaggerXXComponent，需要通过 parent Component 的获取 SubComponent.Builder 方法获取 SubComponent 实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">MainActivity中注入依赖:</div><div class="line"></div><div class="line">@Override</div><div class="line">protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">    super.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line">    App.component().mainBuilder()</div><div class="line">            .build()</div><div class="line">            .inject(this);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Dagger生成的代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">public final class DaggerAppComponent implements AppComponent &#123;</div><div class="line">  //....</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public SubMainComponent.Builder mainBuilder() &#123;</div><div class="line">    return new SubMainComponentBuilder();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public SubSecondComponent.Builder secondBuilder() &#123;</div><div class="line">    return new SubSecondComponentBuilder();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private final class SubMainComponentBuilder implements SubMainComponent.Builder &#123;</div><div class="line">    @Override</div><div class="line">    public SubMainComponent build() &#123;</div><div class="line">      return new SubMainComponentImpl(this);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private final class SubMainComponentImpl implements SubMainComponent &#123;</div><div class="line">    private SubMainComponentImpl(SubMainComponentBuilder builder) &#123;&#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void inject(MainActivity mainActivity) &#123;</div><div class="line">      injectMainActivity(mainActivity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private MainActivity injectMainActivity(MainActivity instance) &#123;</div><div class="line">      MainActivity_MembersInjector.injectPrintService(</div><div class="line">          instance, DaggerAppComponent.this.printServiceProvider.get());</div><div class="line">      return instance;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private final class SubSecondComponentBuilder implements SubSecondComponent.Builder &#123;</div><div class="line">    @Override</div><div class="line">    public SubSecondComponent build() &#123;</div><div class="line">      return new SubSecondComponentImpl(this);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private final class SubSecondComponentImpl implements SubSecondComponent &#123;</div><div class="line">    private SubSecondComponentImpl(SubSecondComponentBuilder builder) &#123;&#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void inject(SecondActivity secondActivity) &#123;</div><div class="line">      injectSecondActivity(secondActivity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private SecondActivity injectSecondActivity(SecondActivity instance) &#123;</div><div class="line">      SecondActivity_MembersInjector.injectPrintService(</div><div class="line">          instance, DaggerAppComponent.this.printServiceProvider.get());</div><div class="line">      return instance;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从代码中可以看出，SubMainComponentImpl中直接使用了DaggerAppComponent.this.printServiceProvider.get()，也就是说Subcomponent中可以使用ParentComponent提供 的依赖</p>
<h5 id="依赖关系-vs-继承关系"><a href="#依赖关系-vs-继承关系" class="headerlink" title="依赖关系 vs 继承关系"></a>依赖关系 vs 继承关系</h5><p>相同点：</p>
<ul>
<li><p>两者都能复用其他 Component 的依赖</p>
</li>
<li><p>有依赖关系和继承关系的 Component 不能有相同的 Scope</p>
</li>
</ul>
<p>区别：</p>
<ul>
<li><p>依赖关系中被依赖的 Component 必须显式地提供公开依赖实例的接口，而 SubComponent 默认继承 parent Component 的依赖。</p>
</li>
<li><p>依赖关系会生成两个独立的 DaggerXXComponent 类，而 SubComponent 不会生成 独立的 DaggerXXComponent 类。</p>
</li>
</ul>
<h4 id="Repeated-modules"><a href="#Repeated-modules" class="headerlink" title="Repeated modules"></a>Repeated modules</h4><p>当相同的 Module 注入到 parent Component 和它的 SubComponent 中时，则每个 Component 都将自动使用这个 Module 的同一实例。也就是如果在 SubComponent.Builder 中调用相同的 Module 或者在返回 SubComponent 的抽象工厂方法中以重复 Module 作为参数时，会出现错误。（前者在编译时不能检测出，是运行时错误）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@Component(modules = &#123;RepeatedModule.class, ...&#125;)</div><div class="line">interface ComponentOne &#123;</div><div class="line">  ComponentTwo componentTwo(RepeatedModule repeatedModule); // COMPILE ERROR!</div><div class="line">  ComponentThree.Builder componentThreeBuilder();</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Subcomponent(modules = &#123;RepeatedModule.class, ...&#125;)</div><div class="line">interface ComponentTwo &#123; ... &#125;</div><div class="line"></div><div class="line">@Subcomponent(modules = &#123;RepeatedModule.class, ...&#125;)</div><div class="line">interface ComponentThree &#123;</div><div class="line">  @Subcomponent.Builder</div><div class="line">  interface Builder &#123;</div><div class="line">    Builder repeatedModule(RepeatedModule repeatedModule);</div><div class="line">    ComponentThree build();</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">DaggerComponentOne.create().componentThreeBuilder()</div><div class="line">    .repeatedModule(new RepeatedModule()) // UnsupportedOperationException!</div><div class="line">    .build();</div></pre></td></tr></table></figure>
<p><a href="https://github.com/zhy060307/dagger2" target="_blank" rel="external">Demo Github地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/10/Dagger2（二）-Lazy、Qualifier、Scope等/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Dagger2（二）-Lazy、Qualifier、Scope等/" itemprop="url">Dagger2（二） Lazy、Qualifier、Scope等</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:40:15+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dagger2/" itemprop="url" rel="index">
                    <span itemprop="name">Dagger2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/10/Dagger2（二）-Lazy、Qualifier、Scope等/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/10/Dagger2（二）-Lazy、Qualifier、Scope等/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/10/Dagger2（二）-Lazy、Qualifier、Scope等/" class="leancloud_visitors" data-flag-title="Dagger2（二） Lazy、Qualifier、Scope等">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Lazy-延迟加载"><a href="#Lazy-延迟加载" class="headerlink" title="Lazy 延迟加载"></a>Lazy 延迟加载</h4><p>使用 @Inject Lazy<xxx>来提供延迟加载,Lazy和Provider功类似</xxx></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lazy</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Return the underlying value, computing the value if necessary. All calls to</div><div class="line">   * the same &#123;<span class="doctag">@code</span> Lazy&#125; instance will return the same result.</div><div class="line">   */</div><div class="line">  <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">   @Inject</div><div class="line">   Lazy&lt;PrintService&gt; printService;</div><div class="line"></div><div class="line">   @Override</div><div class="line">   protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">       super.onCreate(savedInstanceState);</div><div class="line">       setContentView(R.layout.activity_main);</div><div class="line">       DaggerPrintComponent.builder()</div><div class="line">               .build().inject(this);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   public void print(View view) &#123;</div><div class="line">       printService.get().startWork();</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>dagger生成的代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity_MembersInjector</span> <span class="keyword">implements</span> <span class="title">MembersInjector</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Provider&lt;PrintService&gt; printServiceProvider;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MainActivity_MembersInjector</span><span class="params">(Provider&lt;PrintService&gt; printServiceProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.printServiceProvider = printServiceProvider;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MembersInjector&lt;MainActivity&gt; <span class="title">create</span><span class="params">(Provider&lt;PrintService&gt; printServiceProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MainActivity_MembersInjector(printServiceProvider);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">injectMembers</span><span class="params">(MainActivity instance)</span> </span>&#123;</div><div class="line">    injectPrintService(instance, DoubleCheck.lazy(printServiceProvider));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">injectPrintService</span><span class="params">(MainActivity instance, Lazy&lt;PrintService&gt; printService)</span> </span>&#123;</div><div class="line">    instance.printService = printService;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关键代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">injectMembers</span><span class="params">(MainActivity instance)</span> </span>&#123;</div><div class="line">    injectPrintService(instance, DoubleCheck.lazy(printServiceProvider));</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>DoubleCheck.lazy()是将Provider转化为DoubleCheck<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;P extends Provider&lt;T&gt;, T&gt; <span class="function">Lazy&lt;T&gt; <span class="title">lazy</span><span class="params">(P provider)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (provider <span class="keyword">instanceof</span> Lazy) &#123;</div><div class="line">      <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">      <span class="keyword">final</span> Lazy&lt;T&gt; lazy = (Lazy&lt;T&gt;) provider;</div><div class="line">      <span class="comment">// Avoids memoizing a value that is already memoized.</span></div><div class="line">      <span class="comment">// <span class="doctag">NOTE:</span> There is a pathological case where Provider&lt;P&gt; may implement Lazy&lt;L&gt;, but P and L</span></div><div class="line">      <span class="comment">// are different types using covariant return on get(). Right now this is used with</span></div><div class="line">      <span class="comment">// DoubleCheck&lt;T&gt; exclusively, which is implemented such that P and L are always</span></div><div class="line">      <span class="comment">// the same, so it will be fine for that case.</span></div><div class="line">      <span class="keyword">return</span> lazy;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DoubleCheck&lt;T&gt;(checkNotNull(provider));</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>在调用Lazy.get()时，就是调用DoubleCheck.get(),代码如下，返回的是同一个对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) <span class="comment">// cast only happens when result comes from the provider</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">    Object result = instance;</div><div class="line">    <span class="keyword">if</span> (result == UNINITIALIZED) &#123;</div><div class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">        result = instance;</div><div class="line">        <span class="keyword">if</span> (result == UNINITIALIZED) &#123;</div><div class="line">          result = provider.get();</div><div class="line">          instance = reentrantCheck(instance, result);</div><div class="line">          <span class="comment">/* Null out the reference to the provider. We are never going to need it again, so we</span></div><div class="line">           * can make it eligible for GC. */</div><div class="line">          provider = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> (T) result;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用 Lazy延迟加载时，get()方法返回同一个对象</li>
</ul>
<h4 id="Provide-延迟加载"><a href="#Provide-延迟加载" class="headerlink" title="Provide 延迟加载"></a>Provide 延迟加载</h4><p>和Lazy用法一致，但每次调用get()方法，返回不同的对象。</p>
<h4 id="Qualifier-限定符"><a href="#Qualifier-限定符" class="headerlink" title="Qualifier 限定符"></a>Qualifier 限定符</h4><p>在Module中要提供接口的多个实现类，下面的写法编译器会报错</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Module</span>(includes = &#123;AppModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrinterModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Printer <span class="title">providePrinter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PdfPrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Printer <span class="title">provideSamplePrinter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SamplePrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">error: [Dagger/DuplicateBindings] com.zhy.dagger2.printer.Printer is bound multiple times:</div></pre></td></tr></table></figure>
<p> 使用Qualifier可以解决此类问题。创建注解Sample,Pdf他们都被Qualifier标注<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Qualifier</span></div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Pdf &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Qualifier</span></div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Sample &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 添加到对应的Provider中<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> @Module(includes = &#123;AppModule.class&#125;)</div><div class="line">public class PrinterModule &#123;</div><div class="line"></div><div class="line">    @Provides</div><div class="line">    @Pdf</div><div class="line">    public Printer providePrinter() &#123;</div><div class="line">        return new PdfPrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    @Provides</div><div class="line">    @Sample</div><div class="line">    public Printer provideSamplePrinter() &#123;</div><div class="line">        return new SamplePrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>依赖注入时带上对应的Annotation，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Inject</div><div class="line">public PrintService(@Sample Printer printer) &#123;</div><div class="line">    this.printer = printer;</div><div class="line">    System.out.println(&quot;Loading PrintService....&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Named"><a href="#Named" class="headerlink" title="@Named"></a>@Named</h4><p>JSR330中内置的Qualifier，使用起来很方便</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span>(includes = &#123;AppModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrinterModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line"><span class="comment">//  @Pdf</span></div><div class="line">    <span class="meta">@Named</span>(<span class="string">"pdf"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Printer <span class="title">providePrinter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PdfPrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line"><span class="comment">//  @Sample</span></div><div class="line">    <span class="meta">@Named</span>(<span class="string">"sample"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Printer <span class="title">provideSamplePrinter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SamplePrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">PrintService<span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">@Inject</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">PrintService</span><span class="params">(@Named(<span class="string">"pdf"</span>)</span> Printer printer) </span>&#123;</div><div class="line">     <span class="keyword">this</span>.printer = printer;</div><div class="line">     System.out.println(<span class="string">"Loading PrintService...."</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Scope-作用域"><a href="#Scope-作用域" class="headerlink" title="@Scope  作用域"></a>@Scope  作用域</h4><blockquote>
<p>Scope 是用来确定注入的实例的生命周期的，如果没有使用 Scope 注解，Component 每次调用 Module 中的 provide 方法或 Inject 构造函数生成的工厂时都会创建一个新的实例，而使用 Scope 后可以复用之前的依赖实例</p>
</blockquote>
<p>dagger2中提供了@Singleton表示单例，它也是被@Scope所标注</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Scope</span></div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Singleton &#123;&#125;</div></pre></td></tr></table></figure>
<p>现在，我们有两个Activity,MainActivity和SecondActivity,两者都依赖PrintService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    PrintService printService;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        DaggerMainComponent.builder()</div><div class="line">                .build().inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        printService.startWork();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testScope</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">执行print()时，PrintService对象如下</div><div class="line">com.zhy.dagger2 I/System.out: com.zhy.dagger2.printer.PrintService@<span class="number">38</span>bb568</div></pre></td></tr></table></figure>
<p>SecondActivity<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    PrintService printService;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_second);</div><div class="line">        DaggerSecondComponent.builder()</div><div class="line">                .build()</div><div class="line">                .inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testScope</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        System.out.println(printService.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">执行print()时，PrintService对象如下</div><div class="line">I/System.out: com.zhy.dagger2.printer.PrintService@<span class="number">1</span>a9a612</div></pre></td></tr></table></figure></p>
<p>如何让PrintService是单例呢？这时候就用到@Singleton注解了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintService</span> </span>&#123;</div><div class="line"><span class="comment">//.....</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">然后在MainComponent和SecondComponent上标记<span class="meta">@Singleton</span>（必须也是<span class="meta">@Singleton</span>）</div><div class="line"></div><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules = PrinterModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span></span>;</div><div class="line"></div><div class="line">&#125;</div><div class="line">Singleton</div><div class="line"><span class="meta">@Component</span>(modules = PrinterModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SecondComponent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然而，PrintService依然还是不同的对象</p>
<p>MainActivity:<br><br>I/System.out: com.zhy.dagger2.printer.PrintService@38bb568</p>
<p>SecondActivity:<br><br>I/System.out: com.zhy.dagger2.printer.PrintService@a3fd874</p>
<p><strong><em>为什么呢</em>？</strong></p>
<blockquote>
<p>这是因为Component 间接持有依赖实例的引用，把实例的作用域Component 绑定。也即是说同一个Component标注的@Singleton对象才是单例。</p>
</blockquote>
<p>有两种方法：</p>
<h6 id="1-使用相同的Component"><a href="#1-使用相同的Component" class="headerlink" title="1.使用相同的Component"></a>1.使用相同的Component</h6><p>MainActivity和SecondActivity使用同一个Component(AppComponent)</p>
<p>AppComponent<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules = &#123;AppModule.class, PrinterModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppComponent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(App app)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity mainActivity)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在Application中实例化AppComponent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> App app;</div><div class="line">    <span class="keyword">private</span> AppComponent appComponent;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        app = <span class="keyword">this</span>;</div><div class="line">        appComponent = DaggerAppComponent</div><div class="line">                .builder().build();</div><div class="line">        appComponent.inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> AppComponent <span class="title">getAppComponent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> appComponent;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppComponent <span class="title">component</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> app.getAppComponent();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用AppComponent<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    PrintService printService;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        App.component()</div><div class="line">                .inject(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    PrintService printService;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_second);</div><div class="line">        App.component()</div><div class="line">                .inject(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Logcat中输出的PrintService是同一个对象</p>
<pre><code>2019-02-05 23:00:30.640 26381-26381/com.zhy.dagger2 I/System.out: com.zhy.dagger2.printer.PrintService@f90971b
2019-02-05 23:00:30.640 26381-26381/com.zhy.dagger2 I/System.out: Pdf Printer work.....
2019-02-05 23:00:33.859 26381-26381/com.zhy.dagger2 I/System.out: com.zhy.dagger2.printer.PrintService@f90971b
</code></pre><p>分析源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public final class DaggerAppComponent implements AppComponent &#123;</div><div class="line">    //...</div><div class="line">     private DaggerAppComponent(Builder builder) &#123;</div><div class="line">     initialize(builder);</div><div class="line">     &#125;</div><div class="line">    </div><div class="line">    private void initialize(final Builder builder) &#123;</div><div class="line">    this.providePrinterProvider = PrinterModule_ProvidePrinterFactory.create(builder.printerModule);</div><div class="line">    this.printServiceProvider =</div><div class="line">        DoubleCheck.provider(PrintService_Factory.create(providePrinterProvider));</div><div class="line">  &#125;</div><div class="line">  //...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> this.printServiceProvider是DoubleCheck,而DoubleCheck每次get()的是同一个对象。</p>
<h6 id="2-依赖相同的Component"><a href="#2-依赖相同的Component" class="headerlink" title="2.依赖相同的Component"></a>2.依赖相同的Component</h6><p>创建自定义Scope<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Scope</span></div><div class="line"><span class="meta">@Documented</span></div><div class="line"><span class="meta">@Retention</span>(RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ActivityScope &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>AppComponet如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Component</span>(modules = &#123;AppModule.class,</div><div class="line">        PrinterModule.class&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppComponent</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(App app)</span></span>;</div><div class="line">    </div><div class="line">    <span class="function">PrintService <span class="title">printService</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到,在AppComponent中printService()返回PrintService。在一个Component中，方法的参数和返回值Dagger都会给你实例化。</p>
<p>Dagger生成的代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerAppComponent</span> <span class="keyword">implements</span> <span class="title">AppComponent</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> PrinterModule_ProvidePrinterFactory providePrinterProvider;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> Provider&lt;PrintService&gt; printServiceProvider;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">DaggerAppComponent</span><span class="params">(Builder builder)</span> </span>&#123;</div><div class="line"></div><div class="line">    initialize(builder);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title">builder</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Builder();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppComponent <span class="title">create</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Builder().build();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(<span class="keyword">final</span> Builder builder)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.providePrinterProvider = PrinterModule_ProvidePrinterFactory.create(builder.printerModule);</div><div class="line">    <span class="keyword">this</span>.printServiceProvider =</div><div class="line">        DoubleCheck.provider(PrintService_Factory.create(providePrinterProvider));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(App app)</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> PrintService <span class="title">printService</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> printServiceProvider.get();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> PrinterModule printerModule;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> AppComponent <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (printerModule == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.printerModule = <span class="keyword">new</span> PrinterModule();</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> DaggerAppComponent(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@deprecated</span> This module is declared, but an instance is not used in the component. This</div><div class="line">     *     method is a no-op. For more, see https://google.github.io/dagger/unused-modules.</div><div class="line">     */</div><div class="line">    <span class="meta">@Deprecated</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Builder <span class="title">appModule</span><span class="params">(AppModule appModule)</span> </span>&#123;</div><div class="line">      Preconditions.checkNotNull(appModule);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Builder <span class="title">printerModule</span><span class="params">(PrinterModule printerModule)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.printerModule = Preconditions.checkNotNull(printerModule);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>MainComponent和SecondComponent分别依赖AppComponent并且被ActivityScope标注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@ActivityScope</div><div class="line">@Component(dependencies = AppComponent.class)</div><div class="line">public interface MainComponent &#123;</div><div class="line">    void inject(MainActivity activity);</div><div class="line"></div><div class="line">&#125;</div><div class="line">@ActivityScope</div><div class="line">@Component(dependencies = AppComponent.class)</div><div class="line">public interface SecondComponent &#123;</div><div class="line">    void inject(SecondActivity secondActivity);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在MainAcitivy和SecondActivity注入依赖<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">MainActivity的onCreate()中</div><div class="line"></div><div class="line">DaggerMainComponent.builder()</div><div class="line">                .appComponent(App.component())</div><div class="line">                .build()</div><div class="line">                .inject(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>Dagger代码为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public final class DaggerMainComponent implements MainComponent &#123;</div><div class="line">  private AppComponent appComponent;</div><div class="line"></div><div class="line">  private DaggerMainComponent(Builder builder) &#123;</div><div class="line">    this.appComponent = builder.appComponent;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  public static Builder builder() &#123;</div><div class="line">    return new Builder();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  @Override</div><div class="line">  public void inject(MainActivity activity) &#123;</div><div class="line">    injectMainActivity(activity);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  private MainActivity injectMainActivity(MainActivity instance) &#123;</div><div class="line">    MainActivity_MembersInjector.injectPrintService(</div><div class="line">        instance,</div><div class="line">        Preconditions.checkNotNull(</div><div class="line">            appComponent.printService(),</div><div class="line">            &quot;Cannot return null from a non-@Nullable component method&quot;));</div><div class="line">    return instance;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  public static final class Builder &#123;</div><div class="line">    private AppComponent appComponent;</div><div class="line"></div><div class="line">    private Builder() &#123;&#125;</div><div class="line"></div><div class="line">    public MainComponent build() &#123;</div><div class="line">      Preconditions.checkBuilderRequirement(appComponent, AppComponent.class);</div><div class="line">      return new DaggerMainComponent(this);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Builder appComponent(AppComponent appComponent) &#123;</div><div class="line">      this.appComponent = Preconditions.checkNotNull(appComponent);</div><div class="line">      return this;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们看到injectMainActivity()方法中<br>MainActivity_MembersInjector.injectPrintService()调用了appComponent.printService()，由此得到单例的PrintService对象。</p>
<p>对比这两种方法，第二种是推荐的。</p>
<h5 id="使用-Scope的一些经验"><a href="#使用-Scope的一些经验" class="headerlink" title="使用@Scope的一些经验"></a>使用@Scope的一些经验</h5><ul>
<li>@Component关联的@Module中的任何一个@Provides有@scope，则该整个@Component要加上这个scope。</li>
<li>@Component的dependencies与@Component自身的scope不能相同，即组件之间的scope不能相同。</li>
<li>@Singleton的组件不能依赖其他scope的组件，但是其他scope的组件可以依赖@Singleton组件。</li>
<li>没有scope组件不能依赖有scope的组件。</li>
<li>一个component不能同时有多个scope(Subcomponent除外)</li>
</ul>
<h4 id="Binding-Instances"><a href="#Binding-Instances" class="headerlink" title="Binding Instances"></a>Binding Instances</h4><p>通过前面作用域的讲解，可以清楚 Component 可以间接持有 Module 或 Inject 目标类构造函数提供的依赖实例，除了这两种方式，Component 还可以在创建 Component 的时候绑定依赖实例，用以注入。这就是@BindsInstance注解的作用，只能在 Component.Builder 中使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">@Component</div><div class="line">public interface ThirdComponent &#123;</div><div class="line"></div><div class="line">    Login login();</div><div class="line"></div><div class="line">    @Component.Builder</div><div class="line">    interface Builder &#123;</div><div class="line">        @BindsInstance</div><div class="line">        Builder login(Login login);</div><div class="line"></div><div class="line">        ThirdComponent build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    void inject(ThirdActivity thirdActivity);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//Component就可以拥有Login实例了</div><div class="line">public class ThirdActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private ThirdComponent component;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_third);</div><div class="line">        component = DaggerThirdComponent.builder()</div><div class="line">                .login(new Login(&quot;zhangsan&quot;, &quot;lisi&quot;))</div><div class="line">                .build();</div><div class="line">        component</div><div class="line">                .inject(this);</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void login(View view) &#123;</div><div class="line">        TextView tvMsg = findViewById(R.id.tv_msg);</div><div class="line">        Login login = component.login();</div><div class="line">        tvMsg.setText(String.format(&quot;%s %s login success.&quot;, login.getUsername(), login.getPassword()));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>所有@BindsInstance方法必须在build()之前调用。</li>
<li>如果@BindsInstance方法的参数可能为 null，需要再用@Nullable标记，同时标注 Inject 的地方也需要用@Nullable标记。这时 Builder 也可以不调用@BindsInstance方法，这样 Component 会默认设置 instance 为 null。</li>
</ul>
<p><a href="https://github.com/zhy060307/dagger2" target="_blank" rel="external">Demo Github地址</a> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/10/Dagger2（一）Dagger2的基本使用和原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Dagger2（一）Dagger2的基本使用和原理/" itemprop="url">Dagger2（一）Dagger2的基本使用和原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:37:01+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dagger2/" itemprop="url" rel="index">
                    <span itemprop="name">Dagger2</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/10/Dagger2（一）Dagger2的基本使用和原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/10/Dagger2（一）Dagger2的基本使用和原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/10/Dagger2（一）Dagger2的基本使用和原理/" class="leancloud_visitors" data-flag-title="Dagger2（一）Dagger2的基本使用和原理">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Dagger2的基本使用"><a href="#Dagger2的基本使用" class="headerlink" title="Dagger2的基本使用"></a>Dagger2的基本使用</h1><h4 id="引入dagger2"><a href="#引入dagger2" class="headerlink" title="引入dagger2"></a>引入dagger2</h4><p>在build.gradle文件中添加依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">implementation &apos;com.google.dagger:dagger:2.20&apos;</div><div class="line">annotationProcessor &apos;com.google.dagger:dagger-compiler:2.20&apos;</div></pre></td></tr></table></figure>
<p>Android gradle plugin 版本小于2.2时要引入 <a href="https://bitbucket.org/hvisser/android-apt" target="_blank" rel="external">apt插件</a></p>
<h4 id="使用-Inject-注入依赖"><a href="#使用-Inject-注入依赖" class="headerlink" title="使用 @Inject 注入依赖"></a>使用 @Inject 注入依赖</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    PrintService printService;</div><div class="line">    <span class="comment">//.......</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>编译后 在build/generated/source/apt/ 下可以看到生成的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity_MembersInjector</span> <span class="keyword">implements</span> <span class="title">MembersInjector</span>&lt;<span class="title">MainActivity</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Provider&lt;PrintService&gt; printServiceProvider;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MainActivity_MembersInjector</span><span class="params">(Provider&lt;PrintService&gt; printServiceProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.printServiceProvider = printServiceProvider;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MembersInjector&lt;MainActivity&gt; <span class="title">create</span><span class="params">(Provider&lt;PrintService&gt; printServiceProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MainActivity_MembersInjector(printServiceProvider);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">injectMembers</span><span class="params">(MainActivity instance)</span> </span>&#123;</div><div class="line">    injectPrintService(instance, printServiceProvider.get());</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">injectPrintService</span><span class="params">(MainActivity instance, PrintService printService)</span> </span>&#123;</div><div class="line">    instance.printService = printService;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>injectPrintService()方法注入依赖，从 instance.printService = printService;可以看出 @Inject 注入的成员变量不能为private</li>
</ul>
<h4 id="创建依赖对象的实例"><a href="#创建依赖对象的实例" class="headerlink" title="创建依赖对象的实例"></a>创建依赖对象的实例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintService</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Printer printer;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PrintService</span><span class="params">(Printer printer)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.printer = printer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startWork</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.printer.print();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Dagger会生成一个PrintService_Factory类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintService_Factory</span> <span class="keyword">implements</span> <span class="title">Factory</span>&lt;<span class="title">PrintService</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Provider&lt;Printer&gt; printerProvider;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PrintService_Factory</span><span class="params">(Provider&lt;Printer&gt; printerProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.printerProvider = printerProvider;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> PrintService <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> provideInstance(printerProvider);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintService <span class="title">provideInstance</span><span class="params">(Provider&lt;Printer&gt; printerProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PrintService(printerProvider.get());</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintService_Factory <span class="title">create</span><span class="params">(Provider&lt;Printer&gt; printerProvider)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PrintService_Factory(printerProvider);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintService <span class="title">newPrintService</span><span class="params">(Printer printer)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PrintService(printer);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Module-Provides-提供依赖"><a href="#Module-Provides-提供依赖" class="headerlink" title="@Module @Provides 提供依赖"></a>@Module @Provides 提供依赖</h4><p>使用@Inject标注构造方法提供依赖时有限制，比如：</p>
<ul>
<li>依赖对象为接口，而接口是没有构造方法</li>
<li>@Inject不能标注到第三方库</li>
<li>构造方法中的参数是动态配置的</li>
</ul>
<p>这时就需要@Provides标注的方法提供依赖，而@Provides使用时，必须方法@Module标注的类中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Module</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrinterModule</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Printer <span class="title">providePrinter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PdfPrinter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Provides</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Handler <span class="title">provideHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Handler();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Module的优先级比@Inject标注构造函数的高</li>
</ul>
<p>dagger会为每一个@Provides标注的方法生成一个Factory<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PrinterModule_ProvideHandlerFactory</div><div class="line">PrinterModule_ProvidePrinterFactory</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PrinterModule_ProvidePrinterFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span>&lt;<span class="title">Printer</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> PrinterModule <span class="keyword">module</span>;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">PrinterModule_ProvidePrinterFactory</span><span class="params">(PrinterModule <span class="keyword">module</span>)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.<span class="keyword">module</span> = <span class="keyword">module</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> Printer <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> provideInstance(<span class="keyword">module</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Printer <span class="title">provideInstance</span><span class="params">(PrinterModule <span class="keyword">module</span>)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> proxyProvidePrinter(<span class="keyword">module</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrinterModule_ProvidePrinterFactory <span class="title">create</span><span class="params">(PrinterModule <span class="keyword">module</span>)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PrinterModule_ProvidePrinterFactory(<span class="keyword">module</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Printer <span class="title">proxyProvidePrinter</span><span class="params">(PrinterModule instance)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> Preconditions.checkNotNull(</div><div class="line">        instance.providePrinter(), <span class="string">"Cannot return null from a non-@Nullable @Provides method"</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Component-作为桥梁，关联依赖和被依赖的对象"><a href="#Component-作为桥梁，关联依赖和被依赖的对象" class="headerlink" title="@Component 作为桥梁，关联依赖和被依赖的对象"></a>@Component 作为桥梁，关联依赖和被依赖的对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span>(modules = PrinterModule.class)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PrintComponent</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Component类必须是接口后者抽象类</li>
</ul>
<p>在MainActivity调用PrintComponent的inject方法完成注入<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">DaggerPrintComponent.builder()</div><div class="line">               .build().inject(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>dagger为PrintComponent生成的实现类如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerPrintComponent</span> <span class="keyword">implements</span> <span class="title">PrintComponent</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> PrinterModule printerModule;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">DaggerPrintComponent</span><span class="params">(Builder builder)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.printerModule = builder.printerModule;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title">builder</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Builder();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PrintComponent <span class="title">create</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Builder().build();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> PrintService <span class="title">getPrintService</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PrintService(PrinterModule_ProvidePrinterFactory.proxyProvidePrinter(printerModule));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inject</span><span class="params">(MainActivity activity)</span> </span>&#123;</div><div class="line">    injectMainActivity(activity);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> MainActivity <span class="title">injectMainActivity</span><span class="params">(MainActivity instance)</span> </span>&#123;</div><div class="line">    MainActivity_MembersInjector.injectPrintService(instance, getPrintService());</div><div class="line">    <span class="keyword">return</span> instance;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> PrinterModule printerModule;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> PrintComponent <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (printerModule == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.printerModule = <span class="keyword">new</span> PrinterModule();</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> DaggerPrintComponent(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Builder <span class="title">printerModule</span><span class="params">(PrinterModule printerModule)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.printerModule = Preconditions.checkNotNull(printerModule);</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/zhy060307/dagger2" target="_blank" rel="external">Demo Github地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2019/02/10/Guice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/10/Guice/" itemprop="url">Guice</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-10T15:34:45+08:00">
                2019-02-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/10/Guice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/10/Guice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/10/Guice/" class="leancloud_visitors" data-flag-title="Guice">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h3><ul>
<li>Single responsibility   单一职责<blockquote>
<p>a class should have only a single responsibility</p>
</blockquote>
</li>
<li>Open/closed  开闭原则<blockquote>
<p>software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification</p>
</blockquote>
</li>
<li>Liskov substitution  里氏替换原则<blockquote>
<p>objects in a program should be replaceable with instances of their subtypes without altering the correctness of that program.</p>
</blockquote>
</li>
<li>Interface segregation  接口隔离<blockquote>
<p>many client-specific interfaces are better than one general-purpose interface.</p>
</blockquote>
</li>
<li>Dependency inversion   依赖倒置<blockquote>
<p>one should depend upon abstractions, [not] concretions.</p>
<h3 id="依赖倒置-Dependency-inversion-principle"><a href="#依赖倒置-Dependency-inversion-principle" class="headerlink" title="依赖倒置 (Dependency inversion principle)"></a>依赖倒置 (Dependency inversion principle)</h3></blockquote>
</li>
<li>High-level modules should not depend on low-level modules. Both should depend on abstractions.</li>
<li>Abstractions should not depend on details.Details should depend on abstractions.</li>
</ul>
<h3 id="依赖注入-DI-dependency-injection"><a href="#依赖注入-DI-dependency-injection" class="headerlink" title="依赖注入   DI (dependency injection)"></a>依赖注入   DI (dependency injection)</h3><blockquote>
<p>Dependency injection is one form of the broader technique of inversion of control（IoC）.</p>
</blockquote>
<ul>
<li>Reduced Dependencies</li>
<li>More Reusable Code</li>
<li>More Testable Code</li>
<li>More Readable Code</li>
</ul>
<h3 id="JSR330"><a href="#JSR330" class="headerlink" title="JSR330"></a><a href="https://jcp.org/en/jsr/detail?id=330" target="_blank" rel="external">JSR330</a></h3><p>JSR330在javax.inject中规定了依赖注入的标准注解(Annotations)。包括：</p>
<ul>
<li>@Inject : 标记为“可注入”。可用于构造器(constructors), 方法(methods)或字段(fields)</li>
<li>@Qualifier : 限定器</li>
<li>@Scope : 标记作用域</li>
<li>@Named : 基于 String 的限定器</li>
<li>@Singleton : 标记为单例</li>
</ul>
<h3 id="Guice"><a href="#Guice" class="headerlink" title="Guice"></a>Guice</h3><blockquote>
<p>Guice (pronounced ‘juice’) is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.</p>
</blockquote>
<h4 id="Bindings"><a href="#Bindings" class="headerlink" title="Bindings"></a>Bindings</h4><ul>
<li><p>Linked Binding</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">()</span> </span>&#123;</div><div class="line">    bind(Printer.class).to(PdfPrinter.class);</div><div class="line">    bind(PdfPrinter.class).to(ColorPdfPrinter.class);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>BindingAnnotations</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@BindingAnnotation</span></div><div class="line"><span class="meta">@Target</span>(&#123;FIELD, PARAMETER, METHOD&#125;)</div><div class="line"><span class="meta">@Retention</span>(RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Alipay &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bind(Pay.class)</div><div class="line">.annotatedWith(Alipay.class)</div><div class="line">.to(AlipayImpl.class);</div></pre></td></tr></table></figure>
</li>
</ul>
<pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Inject</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">BillService</span><span class="params">(@Alipay Pay pay)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.pay = pay;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>Named</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">bind(Pay.class)</div><div class="line">.annotatedWith(Names.named(<span class="string">"wechat"</span>))</div><div class="line">.to(WechatPayImpl.class);</div><div class="line"></div><div class="line"><span class="meta">@Inject</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPay</span><span class="params">(@Named(<span class="string">"wechat"</span>)</span> Pay pay) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.pay = pay;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Constant Bindings</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line"><span class="meta">@Inject</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectDatabase</span><span class="params">(@Named(<span class="string">"JBDC"</span>)</span> String dbUrl) </span>&#123;</div><div class="line">        <span class="comment">//...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">bind(String.class).annotatedWith(Names.named(<span class="string">"JBDC"</span>)).toInstance(<span class="string">"jdbc:mysql://localhost:5326/emp"</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>ProvidesMethods</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckVersionModule</span> <span class="keyword">extends</span> <span class="title">AbstractModule</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">()</span> </span>&#123;</div><div class="line">            bind(String.class)</div><div class="line">                    .annotatedWith(Names.named(<span class="string">"update url"</span>))</div><div class="line">                    .toInstance(<span class="string">"http://console.qa.roomis.com.cn/api/client-apps/latest"</span>);</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Provides</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Request <span class="title">buildRequest</span><span class="params">(@Named(<span class="string">"update url"</span>)</span> String url) </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Request.Builder()</div><div class="line">                    .url(url)</div><div class="line">                    .addHeader(<span class="string">"X-Consumer-Custom-ID"</span>, <span class="string">"roomis-k12-own"</span>)</div><div class="line">                    .addHeader(<span class="string">"deviceSn"</span>, <span class="string">"000ffd4a014f"</span>)</div><div class="line">                    .addHeader(<span class="string">"apikey"</span>, <span class="string">"0001e01807cd4a9ebab4bbb5576f1815"</span>)</div><div class="line">                    .build();</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Provides</span></div><div class="line">        <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideClient</span><span class="params">()</span> </span>&#123;</div><div class="line">            OkHttpClient.Builder builder = <span class="keyword">new</span> OkHttpClient.Builder();</div><div class="line">            builder.connectTimeout(<span class="number">60</span>, TimeUnit.SECONDS)</div><div class="line">                    .readTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</div><div class="line">                    .writeTimeout(<span class="number">30</span>, TimeUnit.SECONDS);</div><div class="line"></div><div class="line">            <span class="keyword">return</span> builder.build();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ProviderBindings</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrinterModule</span> <span class="keyword">extends</span> <span class="title">AbstractModule</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">()</span> </span>&#123;</div><div class="line">        bind(Printer.class)</div><div class="line">                .toProvider(PrinterProvider.class);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrinterProvider</span> <span class="keyword">implements</span> <span class="title">Provider</span>&lt;<span class="title">Printer</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Printer <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PdfPrinter();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Constructor Bindings</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">_06_ConstructorBindings</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Injector injector = Guice.createInjector(<span class="keyword">new</span> TextEditorModule());</div><div class="line">        TextEditor editor = injector.getInstance(TextEditor.class);</div><div class="line">        editor.makeSpellCheck();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextEditor</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> SpellChecker spellChecker;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TextEditor</span><span class="params">(SpellChecker spellChecker)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.spellChecker = spellChecker;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeSpellCheck</span><span class="params">()</span> </span>&#123;</div><div class="line">        spellChecker.checkSpelling();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Binding Module</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextEditorModule</span> <span class="keyword">extends</span> <span class="title">AbstractModule</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            bind(SpellChecker.class)</div><div class="line">                    .toConstructor(SpellCheckerImpl.class.getConstructor(String.class));</div><div class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException | SecurityException e) &#123;</div><div class="line">            System.out.println(<span class="string">"Required constructor missing"</span>);</div><div class="line">        &#125;</div><div class="line">        bind(String.class)</div><div class="line">                .annotatedWith(Names.named(<span class="string">"JDBC"</span>))</div><div class="line">                .toInstance(<span class="string">"jdbc:mysql://localhost:5326/emp"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//spell checker interface</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SpellChecker</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">checkSpelling</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//spell checker implementation</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpellCheckerImpl</span> <span class="keyword">implements</span> <span class="title">SpellChecker</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String dbUrl;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpellCheckerImpl</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpellCheckerImpl</span><span class="params">(@Named(<span class="string">"JDBC"</span>)</span> String dbUrl) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dbUrl = dbUrl;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkSpelling</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"Start checkSpelling."</span>);</div><div class="line">        System.out.println(dbUrl);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Scopes"><a href="#Scopes" class="headerlink" title="Scopes"></a>Scopes</h4><p>默认创建新实例</p>
<ul>
<li>@Singleton<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintService</span> </span>&#123;</div><div class="line"><span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>或者<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="meta">@Provides</span></div><div class="line"><span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideClient</span><span class="params">()</span> </span>&#123;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bind(Printer.class).to(PdfPrinter.class).in(Singleton.class);</div></pre></td></tr></table></figure></p>
<p>Eager Singletons<br>立即加载<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bind(TransactionLog.class).to(InMemoryTransactionLog.class).asEagerSingleton();</div></pre></td></tr></table></figure></p>
<ul>
<li>@SessionScoped</li>
<li>@RequestScoped</li>
</ul>
<h4 id="Injections"><a href="#Injections" class="headerlink" title="Injections"></a>Injections</h4><ul>
<li>Constructor Injection</li>
<li>Method Injection</li>
<li>Field Injection<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintService</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Printer printer;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PrintService</span><span class="params">(Printer printer)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.printer = printer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//    @Inject</span></div><div class="line"><span class="comment">//    private Printer printer;</span></div><div class="line"></div><div class="line"><span class="comment">//    private Printer printer;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    @Inject</span></div><div class="line"><span class="comment">//    public void setPrinter(Printer printer) &#123;</span></div><div class="line"><span class="comment">//        this.printer = printer;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startWork</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.printer.print();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="Dagger2"><a href="#Dagger2" class="headerlink" title="Dagger2"></a>Dagger2</h2><blockquote>
<p>Dagger is a fully static, compile-time dependency injection framework for both Java and Android. It is an adaptation of an earlier version created by Square and now maintained by Google.</p>
</blockquote>
<p>why reinvent the wheel? </p>
<blockquote>
<p>Dagger 2 is the first to implement the full stack with generated code. </p>
</blockquote>
<h4 id="Start"><a href="#Start" class="headerlink" title="Start"></a>Start</h4><p>build.gradle</p>
<pre><code> implementation &apos;com.google.dagger:dagger:2.20&apos;
annotationProcessor &apos;com.google.dagger:dagger-compiler:2.20&apos;
</code></pre><p>#### </p>
<ul>
<li>Inject</li>
<li>Module</li>
<li>Provides</li>
<li>Component</li>
<li>Scope</li>
<li>Qualifier</li>
</ul>
<p>#<br><a href="https://en.wikipedia.org/wiki/SOLID" target="_blank" rel="external">https://en.wikipedia.org/wiki/SOLID</a> <br><br><a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" target="_blank" rel="external">https://en.wikipedia.org/wiki/Dependency_inversion_principle</a> <br><br><a href="https://blog.csdn.net/briblue/article/details/75093382" target="_blank" rel="external">https://blog.csdn.net/briblue/article/details/75093382</a> <br><br><a href="http://tutorials.jenkov.com/dependency-injection/dependency-injection-benefits.html" target="_blank" rel="external">http://tutorials.jenkov.com/dependency-injection/dependency-injection-benefits.html</a> <br><br><a href="https://blog.csdn.net/xtayfjpk/article/details/40657781" target="_blank" rel="external">https://blog.csdn.net/xtayfjpk/article/details/40657781</a></p>
<p><a href="https://google.github.io/dagger/" target="_blank" rel="external">https://google.github.io/dagger/</a> <br><br><a href="https://blog.csdn.net/qq_17766199/article/details/73030696" target="_blank" rel="external">https://blog.csdn.net/qq_17766199/article/details/73030696</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2018/07/10/ADB（Android-Debug-Bridge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/10/ADB（Android-Debug-Bridge/" itemprop="url">ADB（Android Debug Bridge)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-10T09:47:20+08:00">
                2018-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/10/ADB（Android-Debug-Bridge/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/07/10/ADB（Android-Debug-Bridge/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/10/ADB（Android-Debug-Bridge/" class="leancloud_visitors" data-flag-title="ADB（Android Debug Bridge)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="ADB（Android-Debug-Bridge"><a href="#ADB（Android-Debug-Bridge" class="headerlink" title="ADB（Android Debug Bridge)"></a>ADB（Android Debug Bridge)</h2><p>Android调试桥（adb），它是一个通用命令行工具，可以管理、调试Emulator(模拟机)或Device(安卓真机)，并且提供对 Unix shell的访问。它是一个C/S架构的应用程序，由三部分组成</p>
<ul>
<li>Client端 ：运行在开发机器中, 即你的开发PC机. 用来发送adb命令。</li>
<li>Deamon守护进程 ：该组件在设备上运行命令。后台程序在每个模拟器或设备实例上作为后台进程运行。</li>
<li>Server端 ：作为一个后台进程运行在开发机器中, 即你的开发PC机。 用来管理PC中的Client端和手机的Deamon之间的通信。</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>android_sdk/platform-tools/</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export ANDROID_HOME=/Users/zhaohaiyang/Library/Android/sdk</div><div class="line">export PATH=$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools</div></pre></td></tr></table></figure>
<ul>
<li>brew cask install android-platform-tools</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/07/10/ADB（Android-Debug-Bridge/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2018/06/19/Mysql-连接查询/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/19/Mysql-连接查询/" itemprop="url">Mysql 连接查询</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-19T09:40:50+08:00">
                2018-06-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/19/Mysql-连接查询/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/19/Mysql-连接查询/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/19/Mysql-连接查询/" class="leancloud_visitors" data-flag-title="Mysql 连接查询">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://www.runoob.com/mysql/mysql-join.html" target="_blank" rel="external">Join 查询有三种</a></p>
<ul>
<li>INNER JOIN （内连接|等值连接） ： 获取连个表中 满足字段匹配关系的记录，相当取交集。</li>
<li>LEFT JOIN (左连接) ：查询左边所有值，满足所有匹配关系的记录，即使右表中没有对应的的匹配记录。</li>
<li>RIGHT JOIN （有连接）<br>：和LEFT JOIN 相反，查询右边的所有值，即使左边中没有对应的匹配记录。</li>
</ul>
<p>两张表如下</p>
<pre><code>Database changed
MariaDB [test_db]&gt; show tables;
+-------------------+
| Tables_in_test_db |
+-------------------+
| runoob_tbl        |
| tcount_tbl        |
+-------------------+


MariaDB [test_db]&gt; select * from runoob_tbl;
+-----------+---------------+---------------+-----------------+
| runoob_id | runoob_title  | runoob_author | submission_date |
+-----------+---------------+---------------+-----------------+
|         1 | 学习 PHP      | 菜鸟教程      | 2017-04-12      |
|         2 | 学习 MySQL    | 菜鸟教程      | 2017-04-12      |
|         3 | 学习 Java     | RUNOOB.COM    | 2015-05-01      |
|         4 | 学习 Python   | RUNOOB.COM    | 2016-03-06      |
|         5 | 学习 C        | FK            | 2017-04-05      |
+-----------+---------------+---------------+-----------------+

MariaDB [test_db]&gt; select * from tcount_tbl;
+---------------+--------------+
| runoob_author | runoob_count |
+---------------+--------------+
| 菜鸟教程      |           10 |
| RUNOOB.COM    |           20 |
| Google        |           22 |
+---------------+--------------+
</code></pre><h4 id="INNER-JOIN-（可以使用INNER-直接使用JOIN）"><a href="#INNER-JOIN-（可以使用INNER-直接使用JOIN）" class="headerlink" title="INNER JOIN （可以使用INNER,直接使用JOIN）"></a>INNER JOIN （可以使用INNER,直接使用JOIN）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a.runoob_id,a.runoob_title,a.runoob_author,b.runoob_count from runoob_tbl a inner join tcount_tbl b on a.runoob_author = b.runoob_author</div></pre></td></tr></table></figure>
<pre><code>+-----------+---------------+---------------+--------------+
| runoob_id | runoob_title  | runoob_author | runoob_count |
+-----------+---------------+---------------+--------------+
|         1 | 学习 PHP      | 菜鸟教程      |           10 |
|         2 | 学习 MySQL    | 菜鸟教程      |           10 |
|         3 | 学习 Java     | RUNOOB.COM    |           20 |
|         4 | 学习 Python   | RUNOOB.COM    |           20 |
+-----------+---------------+---------------+--------------+
</code></pre><p>可以看出查询的记录是满足 on a.runoob_author = b.runoob_author 的交集。</p>
<ul>
<li>INNER JOIN 可以用等价的 WHERE子句替换。<br>等价的SQL：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a.runoob_id,a.runoob_title,a.runoob_author,b.runoob_count from runoob_tbl a , tcount_tbl b where a.runoob_author = b.runoob_author;</div></pre></td></tr></table></figure>
<pre><code>MariaDB [test_db]&gt; select          a.runoob_id,a.runoob_title,a.runoob_author,b.runoob_count from runoob_tbl a , tcount_tbl b where a.runoob_author = b.runoob_author;
+-----------+---------------+---------------+--------------+
| runoob_id | runoob_title  | runoob_author | runoob_count |
+-----------+---------------+---------------+--------------+
|         1 | 学习 PHP      | 菜鸟教程      |           10 |
|         2 | 学习 MySQL    | 菜鸟教程      |           10 |
|         3 | 学习 Java     | RUNOOB.COM    |           20 |
|         4 | 学习 Python   | RUNOOB.COM    |           20 |
+-----------+---------------+---------------+--------------+
</code></pre><h4 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_db]&gt; select a.runoob_id,a.runoob_author,b.runoob_count from runoob_tbl a left join tcount_tbl b on  a.runoob_author = b.runoob_author;</div><div class="line">+-----------+---------------+--------------+</div><div class="line">| runoob_id | runoob_author | runoob_count |</div><div class="line">+-----------+---------------+--------------+</div><div class="line">|         1 | 菜鸟教程      |           10 |</div><div class="line">|         2 | 菜鸟教程      |           10 |</div><div class="line">|         3 | RUNOOB.COM    |           20 |</div><div class="line">|         4 | RUNOOB.COM    |           20 |</div><div class="line">|         5 | FK            |         NULL |</div><div class="line">+-----------+---------------+--------------+</div></pre></td></tr></table></figure>
<h4 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h4><pre><code>MariaDB [test_db]&gt; select a.runoob_id,a.runoob_author,b.runoob_count from runoob_tbl a right join tcount_tbl b on  a.runoob_author = b.runoob_author;
+-----------+---------------+--------------+
| runoob_id | runoob_author | runoob_count |
+-----------+---------------+--------------+
|         1 | 菜鸟教程      |           10 |
|         2 | 菜鸟教程      |           10 |
|         3 | RUNOOB.COM    |           20 |
|         4 | RUNOOB.COM    |           20 |
|      NULL | NULL          |           22 |
+-----------+---------------+--------------+
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://forevercoder.com/2018/04/22/Vue2-0-一-基础指令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="forevercoder">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ForeverCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/22/Vue2-0-一-基础指令/" itemprop="url">Vue2.0(一)基础指令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-22T10:59:42+08:00">
                2018-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端开发/" itemprop="url" rel="index">
                    <span itemprop="name">前端开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/22/Vue2-0-一-基础指令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/04/22/Vue2-0-一-基础指令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/04/22/Vue2-0-一-基础指令/" class="leancloud_visitors" data-flag-title="Vue2.0(一)基础指令">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>官方 <a href="https://cn.vuejs.org" target="_blank" rel="external">https://cn.vuejs.org</a></li>
<li>下载vue.js<ul>
<li>开发环境：包含完整的警告和调试模式</li>
<li>生产环境：删除了警告，30.90KB min+gzip</li>
</ul>
</li>
<li><p>引入项目</p>
<ul>
<li><p>CDN  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>直接在script中引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;../assets/js/vue.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/04/22/Vue2-0-一-基础指令/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">forevercoder</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">forevercoder</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"forevercoder"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("KGYQnDk6wbtrM9X6rzcSS7Ue-gzGzoHsz", "gTAJRCQN6N5oYGyBDDL301fK");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
